# Self-Blind-VSR æ•°æ®é›†æ ¼å¼è¯´æ˜

## ç›®å½•

1. [æ•°æ®é›†æ¦‚è¿°](#æ•°æ®é›†æ¦‚è¿°)
2. [è®­ç»ƒæ•°æ®é›†æ ¼å¼](#è®­ç»ƒæ•°æ®é›†æ ¼å¼)
3. [æµ‹è¯•æ•°æ®é›†æ ¼å¼](#æµ‹è¯•æ•°æ®é›†æ ¼å¼)
4. [æ•°æ®é›†å‡†å¤‡æŒ‡å—](#æ•°æ®é›†å‡†å¤‡æŒ‡å—)
5. [é…ç½®æ–‡ä»¶è¯´æ˜](#é…ç½®æ–‡ä»¶è¯´æ˜)
6. [æ•°æ®åŠ è½½æµç¨‹](#æ•°æ®åŠ è½½æµç¨‹)
7. [å¸¸è§é—®é¢˜ä¸è§£å†³](#å¸¸è§é—®é¢˜ä¸è§£å†³)

---

## æ•°æ®é›†æ¦‚è¿°

Self-Blind-VSR æ”¯æŒå¤šç§æ•°æ®é›†æ ¼å¼ï¼Œä¸»è¦ç”¨äºè§†é¢‘è¶…åˆ†è¾¨ç‡ä»»åŠ¡ã€‚é¡¹ç›®é‡‡ç”¨**åœ¨çº¿æ•°æ®ç”Ÿæˆ**æœºåˆ¶ï¼Œå³åœ¨è®­ç»ƒæ—¶åŠ¨æ€ç”Ÿæˆæ¨¡ç³Šå’Œé™é‡‡æ ·çš„ä½åˆ†è¾¨ç‡æ•°æ®ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹ç‚¹

-   **ğŸ’» åŠ¨æ€æ•°æ®ç”Ÿæˆ**ï¼šè®­ç»ƒæ—¶å®æ—¶ç”Ÿæˆ LR æ•°æ®ï¼Œæ— éœ€é¢„å­˜å‚¨
-   **ğŸ¬ è§†é¢‘åºåˆ—å¤„ç†**ï¼šæ”¯æŒå¤šå¸§è¾“å…¥çš„æ—¶åºå»ºæ¨¡
-   **ğŸ”§ å¤šç§é€€åŒ–æ¨¡å‹**ï¼šæ”¯æŒé«˜æ–¯æ¨¡ç³Šå’ŒçœŸå®æ¨¡ç³Šä¸¤ç§é€€åŒ–
-   **ğŸ“Š çµæ´»é…ç½®**ï¼šæ”¯æŒä¸åŒåˆ†è¾¨ç‡å’Œåºåˆ—é•¿åº¦

### ğŸ“Š æ”¯æŒçš„æ•°æ®é›†ç±»å‹

| æ•°æ®é›†ç±»å‹              | ç”¨é€”      | é€€åŒ–æ¨¡å‹  | è¾“å…¥æ ¼å¼     |
| ----------------------- | --------- | --------- | ------------ |
| REDS_BLURDOWN_GAUSSIAN  | è®­ç»ƒ      | é«˜æ–¯æ¨¡ç³Š  | HR è§†é¢‘åºåˆ—  |
| REDS_BLURDOWN_REALISTIC | è®­ç»ƒ      | çœŸå®æ¨¡ç³Š  | HR è§†é¢‘åºåˆ—  |
| REDS_HRLR               | éªŒè¯/æµ‹è¯• | é¢„å®šä¹‰ LR | HR+LR è§†é¢‘å¯¹ |

---

## è®­ç»ƒæ•°æ®é›†æ ¼å¼

### ğŸ“ ç›®å½•ç»“æ„

#### REDS è®­ç»ƒé›†ç»“æ„

```
dataset/
â””â”€â”€ REDS/
    â””â”€â”€ train/
        â””â”€â”€ HR/                    # é«˜åˆ†è¾¨ç‡è§†é¢‘ç›®å½•
            â”œâ”€â”€ 000/               # è§†é¢‘åºåˆ— 000
            â”‚   â”œâ”€â”€ 00000000.png   # ç¬¬0å¸§
            â”‚   â”œâ”€â”€ 00000001.png   # ç¬¬1å¸§
            â”‚   â”œâ”€â”€ 00000002.png   # ç¬¬2å¸§
            â”‚   â””â”€â”€ ...            # æ›´å¤šå¸§
            â”œâ”€â”€ 001/               # è§†é¢‘åºåˆ— 001
            â”‚   â”œâ”€â”€ 00000000.png
            â”‚   â”œâ”€â”€ 00000001.png
            â”‚   â””â”€â”€ ...
            â”œâ”€â”€ 002/
            â””â”€â”€ ...                # æ›´å¤šè§†é¢‘åºåˆ—
```

### ğŸ”§ é…ç½®å‚æ•°

#### è®­ç»ƒé…ç½®ç¤ºä¾‹

```python
# åœ¨ option/template.py ä¸­çš„é…ç½®
args.data_train = 'REDS_BLURDOWN_REALISTIC'  # æ•°æ®é›†ç±»å‹
args.dir_data = '../dataset/REDS/train'       # æ•°æ®æ ¹ç›®å½•
args.n_sequence = 5                           # è¾“å…¥åºåˆ—é•¿åº¦
args.n_frames_per_video = 50                  # æ¯ä¸ªè§†é¢‘ä½¿ç”¨çš„å¸§æ•°
args.patch_size = 160                         # è®­ç»ƒpatchå¤§å°
args.scale = 4                                # è¶…åˆ†è¾¨ç‡å€æ•°
```

### ğŸ“· å›¾åƒæ ¼å¼è¦æ±‚

#### åŸºæœ¬è¦æ±‚

-   **æ–‡ä»¶æ ¼å¼**ï¼šPNG, JPG, JPEG
-   **è‰²å½©ç©ºé—´**ï¼šRGB
-   **ä½æ·±åº¦**ï¼š8 ä½æˆ– 16 ä½
-   **å‘½åè§„åˆ™**ï¼šæŒ‰å¸§åºå·é€’å¢å‘½åï¼ˆå¦‚ï¼š00000000.png, 00000001.pngï¼‰

#### åˆ†è¾¨ç‡è¦æ±‚

| é…ç½®é¡¹     | è¦æ±‚                     | ç¤ºä¾‹               |
| ---------- | ------------------------ | ------------------ |
| è¾“å…¥åˆ†è¾¨ç‡ | ä»»æ„ï¼Œè®­ç»ƒæ—¶ä¼šè£å‰ª patch | 1920Ã—1080, 720Ã—480 |
| patch_size | å¯è¢« scale æ•´é™¤          | 160 (4 å€è¶…åˆ†)     |
| æœ€å°å°ºå¯¸   | â‰¥ patch_size Ã— scale     | â‰¥ 640Ã—640          |

### ğŸ¬ è§†é¢‘åºåˆ—è¦æ±‚

#### åºåˆ—é•¿åº¦

-   **æœ€å°é•¿åº¦**ï¼šâ‰¥ n_sequenceï¼ˆé»˜è®¤ 5 å¸§ï¼‰
-   **è®­ç»ƒé•¿åº¦**ï¼šç”± `n_frames_per_video` æ§åˆ¶ï¼ˆé»˜è®¤ 50 å¸§ï¼‰
-   **å¸§ç‡**ï¼šæ— ç‰¹æ®Šè¦æ±‚ï¼Œä¿æŒä¸€è‡´å³å¯

#### å†…å®¹è¦æ±‚

-   **åœºæ™¯è¿ç»­æ€§**ï¼šå¸§é—´å˜åŒ–ä¸å®œè¿‡å¤§
-   **è¿åŠ¨å¹…åº¦**ï¼šé€‚ä¸­çš„è¿åŠ¨å¹…åº¦æœ‰åˆ©äºå…‰æµä¼°è®¡
-   **çº¹ç†ä¸°å¯Œåº¦**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨è¿‡æ»¤è¿‡äºå¹³æ»‘çš„ patch

---

## æµ‹è¯•æ•°æ®é›†æ ¼å¼

### ğŸ“ ç›®å½•ç»“æ„

#### REDS_HRLR æµ‹è¯•é›†ç»“æ„

```
dataset/
â”œâ”€â”€ gt/                        # æµ‹è¯•é›†Ground Truth
â”‚   â”œâ”€â”€ 000/                   # æµ‹è¯•è§†é¢‘ 000
â”‚   â”‚   â”œâ”€â”€ 00000.jpg         # GTç¬¬0å¸§
â”‚   â”‚   â”œâ”€â”€ 00001.jpg         # GTç¬¬1å¸§
â”‚   â”‚   â”œâ”€â”€ 00002.jpg         # GTç¬¬2å¸§
â”‚   â”‚   â””â”€â”€ ...               # æ›´å¤šå¸§ (é€šå¸¸76å¸§)
â”‚   â”œâ”€â”€ 001/                   # æµ‹è¯•è§†é¢‘ 001
â”‚   â”œâ”€â”€ 002/                   # æµ‹è¯•è§†é¢‘ 002
â”‚   â””â”€â”€ 003/                   # æµ‹è¯•è§†é¢‘ 003
â””â”€â”€ input/                     # ä½åˆ†è¾¨ç‡è¾“å…¥ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ 000/
    â”‚   â”œâ”€â”€ 00000.jpg         # LRç¬¬0å¸§
    â”‚   â”œâ”€â”€ 00001.jpg         # LRç¬¬1å¸§
    â”‚   â””â”€â”€ ...
    â””â”€â”€ ...
```

### ğŸ”§ æµ‹è¯•é…ç½®

#### æµ‹è¯•é…ç½®ç¤ºä¾‹

```python
args.data_test = 'REDS_HRLR'                  # æµ‹è¯•æ•°æ®é›†ç±»å‹
args.dir_data_test = '../dataset'             # æµ‹è¯•æ•°æ®æ ¹ç›®å½•
args.test_only = True                          # ä»…æµ‹è¯•æ¨¡å¼
args.save_images = True                        # ä¿å­˜ç»“æœå›¾åƒ
```

### ğŸ“Š æµ‹è¯•æ•°æ®è¦æ±‚

#### æ ‡å‡†æµ‹è¯•é›†

-   **REDS4**ï¼š4 ä¸ªè§†é¢‘åºåˆ—ï¼Œæ¯ä¸ªçº¦ 76 å¸§
-   **Vid4**ï¼š4 ä¸ªç»å…¸è§†é¢‘åºåˆ—
-   **å…¶ä»–**ï¼šå¯è‡ªå®šä¹‰æµ‹è¯•é›†

#### æ–‡ä»¶å‘½åè§„åˆ™

```python
# GTæ–‡ä»¶å‘½åï¼švideo_id/frame_id.ext
gt/000/00000.jpg  # è§†é¢‘000çš„ç¬¬0å¸§
gt/000/00001.jpg  # è§†é¢‘000çš„ç¬¬1å¸§

# æ–‡ä»¶åä¼šè¢«å¤„ç†ä¸ºï¼š000.00000 æ ¼å¼
# å¯¹åº”ä»£ç ï¼švideo_name.frame_name
```

---

## æ•°æ®é›†å‡†å¤‡æŒ‡å—

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### 1. ä¸‹è½½ REDS æ•°æ®é›†

```bash
# ä¸‹è½½REDSè®­ç»ƒé›†ï¼ˆçº¦750GBï¼‰
wget https://data.vision.ee.ethz.ch/cvl/REDS/REDS_train_HR.zip

# è§£å‹åˆ°æŒ‡å®šç›®å½•
unzip REDS_train_HR.zip -d dataset/REDS/train/

# ç¡®ä¿ç›®å½•ç»“æ„æ­£ç¡®
ls dataset/REDS/train/HR/
# åº”è¯¥çœ‹åˆ°ï¼š000/ 001/ 002/ ... 269/
```

#### 2. å‡†å¤‡æµ‹è¯•é›†

```bash
# ä¸‹è½½REDSéªŒè¯é›†
wget https://data.vision.ee.ethz.ch/cvl/REDS/REDS_val_HR.zip

# è§£å‹å¹¶é‡å‘½åä¸ºgt
unzip REDS_val_HR.zip -d dataset/
mv dataset/REDS_val_HR dataset/gt

# æ£€æŸ¥æµ‹è¯•é›†
ls dataset/gt/
# åº”è¯¥çœ‹åˆ°ï¼š000/ 001/ 002/ 003/
```

#### 3. éªŒè¯æ•°æ®é›†

```python
# è¿è¡Œæ•°æ®é›†éªŒè¯è„šæœ¬
cd jittor_self_blind_vsr
python -c "
from data.reds_blurdown_realistic import REDS_BLURDOWN_REALISTIC
from data.reds_hrlr import REDS_HRLR
from option import args

# æµ‹è¯•è®­ç»ƒé›†åŠ è½½
train_data = REDS_BLURDOWN_REALISTIC(args, train=True)
print(f'è®­ç»ƒé›†è§†é¢‘æ•°é‡: {train_data.num_video}')
print(f'è®­ç»ƒé›†å¸§æ•°é‡: {train_data.num_frame}')

# æµ‹è¯•éªŒè¯é›†åŠ è½½
test_data = REDS_HRLR(args, train=False)
print(f'æµ‹è¯•é›†è§†é¢‘æ•°é‡: {test_data.num_video}')
print(f'æµ‹è¯•é›†å¸§æ•°é‡: {test_data.num_frame}')
"
```

### ğŸ”§ è‡ªå®šä¹‰æ•°æ®é›†

#### åˆ›å»ºè‡ªå®šä¹‰è®­ç»ƒé›†

1. **å‡†å¤‡ HR è§†é¢‘åºåˆ—**

```bash
# åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†ç›®å½•
mkdir -p dataset/MyDataset/train/HR

# æ¯ä¸ªè§†é¢‘ä¸€ä¸ªç›®å½•ï¼ŒæŒ‰é¡ºåºå‘½åå¸§
dataset/MyDataset/train/HR/
â”œâ”€â”€ video_001/
â”‚   â”œâ”€â”€ frame_00000.png
â”‚   â”œâ”€â”€ frame_00001.png
â”‚   â””â”€â”€ ...
â”œâ”€â”€ video_002/
â””â”€â”€ ...
```

2. **ä¿®æ”¹é…ç½®**

```python
# åœ¨ option/template.py ä¸­æ·»åŠ è‡ªå®šä¹‰é…ç½®
elif args.template == 'Custom_Dataset':
    args.data_train = 'REDS_BLURDOWN_REALISTIC'  # ä½¿ç”¨ç›¸åŒçš„åŠ è½½å™¨
    args.dir_data = '../dataset/MyDataset/train'  # ä¿®æ”¹æ•°æ®è·¯å¾„
    # å…¶ä»–å‚æ•°ä¿æŒä¸å˜
```

3. **åˆ›å»ºæ•°æ®åŠ è½½å™¨**ï¼ˆå¯é€‰ï¼‰

```python
# åœ¨ data/ ç›®å½•ä¸‹åˆ›å»º mydataset.py
from data.videodata_online_realistic import VIDEODATA_ONLINE_REALISTIC

class MyDataset(VIDEODATA_ONLINE_REALISTIC):
    def __init__(self, args, name='MyDataset', train=True):
        super().__init__(args, name=name, train=train)

    def _set_filesystem(self, dir_data):
        print(f"Loading {self.name} Dataset")
        self.apath = dir_data
        self.dir_gt = os.path.join(self.apath, 'HR')  # æˆ–è‡ªå®šä¹‰å­ç›®å½•
```

---

## é…ç½®æ–‡ä»¶è¯´æ˜

### ğŸ“‹ å…³é”®å‚æ•°è¯¦è§£

#### æ•°æ®ç›¸å…³å‚æ•°

```python
# æ•°æ®é›†é…ç½®
args.data_train = 'REDS_BLURDOWN_REALISTIC'    # è®­ç»ƒæ•°æ®é›†ç±»å‹
args.data_test = 'REDS_HRLR'                   # æµ‹è¯•æ•°æ®é›†ç±»å‹
args.dir_data = '../dataset/REDS/train'        # è®­ç»ƒæ•°æ®è·¯å¾„
args.dir_data_test = '../dataset'              # æµ‹è¯•æ•°æ®è·¯å¾„

# åºåˆ—é…ç½®
args.n_sequence = 5                            # è¾“å…¥åºåˆ—é•¿åº¦ï¼ˆå¥‡æ•°ï¼‰
args.n_frames_per_video = 50                   # æ¯è§†é¢‘ä½¿ç”¨å¸§æ•°

# å›¾åƒé…ç½®
args.patch_size = 160                          # è®­ç»ƒpatchå¤§å°
args.scale = 4                                 # è¶…åˆ†è¾¨ç‡å€æ•°
args.n_colors = 3                              # é¢œè‰²é€šé“æ•°
args.rgb_range = 255                           # RGBå€¼èŒƒå›´

# é€€åŒ–é…ç½®
args.ksize = 13                                # æ¨¡ç³Šæ ¸å¤§å°
args.HR_in = False                             # æ˜¯å¦è¾“å…¥HRï¼ˆç”¨äºæ¶ˆèï¼‰
```

#### è®­ç»ƒç›¸å…³å‚æ•°

```python
# è®­ç»ƒé…ç½®
args.batch_size = 2                            # æ‰¹å¤„ç†å¤§å°
args.patch_size = 160                          # patchå¤§å°
args.no_augment = False                        # æ•°æ®å¢å¼ºå¼€å…³
args.process = False                           # é¢„åŠ è½½æ•°æ®å¼€å…³

# ä¼˜åŒ–é…ç½®
args.lr = 1e-4                                # å­¦ä¹ ç‡
args.epochs = 500                             # è®­ç»ƒè½®æ•°
args.test_every = 1000                        # æµ‹è¯•é—´éš”
```

### ğŸ”„ æ¨¡æ¿ç³»ç»Ÿ

#### é¢„å®šä¹‰æ¨¡æ¿

-   **Self_Blind_VSR_Gaussian**ï¼šé«˜æ–¯æ¨¡ç³Šé€€åŒ–è®­ç»ƒ
-   **Self_Blind_VSR_Realistic**ï¼šçœŸå®æ¨¡ç³Šé€€åŒ–è®­ç»ƒ

#### ä½¿ç”¨æ–¹æ³•

```bash
# ä½¿ç”¨é¢„å®šä¹‰æ¨¡æ¿
python main.py --template Self_Blind_VSR_Realistic

# è‡ªå®šä¹‰å‚æ•°è¦†ç›–
python main.py --template Self_Blind_VSR_Realistic --batch_size 1 --lr 5e-5
```

---

## æ•°æ®åŠ è½½æµç¨‹

### ğŸ”„ åŠ è½½æœºåˆ¶è¯¦è§£

#### 1. åˆå§‹åŒ–é˜¶æ®µ

```python
# æ•°æ®é›†åˆå§‹åŒ–æµç¨‹
dataset = REDS_BLURDOWN_REALISTIC(args, train=True)
# 1. æ‰«æè§†é¢‘ç›®å½•ï¼š_scan()
# 2. ç»Ÿè®¡è§†é¢‘å’Œå¸§æ•°ï¼šè®¡ç®— num_video, num_frame
# 3. å¯é€‰é¢„åŠ è½½ï¼š_load() å¦‚æœ args.process=True
```

#### 2. æ•°æ®è·å–é˜¶æ®µ

```python
# å•ä¸ªæ ·æœ¬è·å–ï¼š__getitem__(idx)
def __getitem__(self, idx):
    # 1. æ ¹æ®idxæ‰¾åˆ°å¯¹åº”è§†é¢‘å’Œå¸§ä½ç½®
    video_idx, frame_idx = self._find_video_num(idx, n_poss_frames)

    # 2. åŠ è½½è¿ç»­çš„n_sequenceå¸§
    gts = self._load_file(idx)  # shape: [n_seq, H, W, C]

    # 3. è£å‰ªpatchï¼ˆè®­ç»ƒæ—¶ï¼‰æˆ–è°ƒæ•´å°ºå¯¸ï¼ˆæµ‹è¯•æ—¶ï¼‰
    gts_patch = self.get_patch(gts_concat)

    # 4. ç”Ÿæˆé€€åŒ–æ ¸
    kernel = self.get_blur_kernel(train=self.train)

    # 5. ç”Ÿæˆä½åˆ†è¾¨ç‡è¾“å…¥
    inputs = [self.get_lr_blur_down(gt, kernel) for gt in gts_list]

    # 6. è½¬æ¢ä¸ºtensorå¹¶è¿”å›
    return input_tensors, gt_tensors, kernel_tensor, filenames
```

#### 3. æ•°æ®å¢å¼º

```python
# è®­ç»ƒæ—¶çš„æ•°æ®å¢å¼º
if not args.no_augment:
    gt_patch = utils.data_augment(gt_patch)[0]
    # åŒ…æ‹¬ï¼šéšæœºç¿»è½¬ã€æ—‹è½¬ã€è‰²å½©å˜æ¢ç­‰
```

### ğŸ“Š æ•°æ®æµè¯¦è§£

#### è¾“å…¥æ•°æ®æµ

```
åŸå§‹HRè§†é¢‘ -> è£å‰ªpatch -> ç”Ÿæˆæ¨¡ç³Šæ ¸ -> æ¨¡ç³Š+é™é‡‡æ · -> LRè¾“å…¥
    â†“            â†“           â†“            â†“            â†“
  [H,W,3]    [160,160,3]   [13,13]    [40,40,3]   tensor
```

#### è¾“å‡ºæ•°æ®æ ¼å¼

```python
# æ•°æ®åŠ è½½å™¨è¿”å›çš„æ•°æ®æ ¼å¼
input_tensors:  torch.Size([n_seq, 3, H_lr, W_lr])    # LRè¾“å…¥åºåˆ—
gt_tensors:     torch.Size([n_seq, 3, H_hr, W_hr])    # HRç›®æ ‡åºåˆ—
kernel_tensor:  torch.Size([n_seq, 1, 20, 20])        # æ¨¡ç³Šæ ¸ï¼ˆpaddingåˆ°20x20ï¼‰
filenames:      List[str]                              # æ–‡ä»¶ååˆ—è¡¨
```

### âš¡ æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®åŠ è½½ä¼˜åŒ–

```python
# é¢„åŠ è½½é€‰é¡¹
args.process = True     # å¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜
                       # ä¼˜ç‚¹ï¼šè®­ç»ƒæ—¶æ— IOå»¶è¿Ÿ
                       # ç¼ºç‚¹ï¼šéœ€è¦å¤§é‡å†…å­˜

args.process = False    # æŒ‰éœ€åŠ è½½ï¼ˆé»˜è®¤ï¼‰
                       # ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨å°
                       # ç¼ºç‚¹ï¼šæ¯æ¬¡è®­ç»ƒæœ‰IOå¼€é”€
```

#### å¤šçº¿ç¨‹åŠ è½½

```python
# æ•°æ®åŠ è½½å™¨é…ç½®
from jittor.dataset import DataLoader

loader = DataLoader(
    dataset=train_dataset,
    batch_size=args.batch_size,
    shuffle=True,
    num_workers=4,      # å¤šçº¿ç¨‹åŠ è½½
    drop_last=True
)
```

---

## å¸¸è§é—®é¢˜ä¸è§£å†³

### ğŸš¨ æ•°æ®é›†é—®é¢˜

#### é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ°æ•°æ®æ–‡ä»¶

```
FileNotFoundError: [Errno 2] No such file or directory: '../dataset/REDS/train/HR'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ£€æŸ¥ç›®å½•ç»“æ„
ls -la dataset/REDS/train/
# ç¡®ä¿å­˜åœ¨ HR/ ç›®å½•

# æ£€æŸ¥é…ç½®è·¯å¾„
grep -r "dir_data" option/template.py
# ç¡®ä¿è·¯å¾„é…ç½®æ­£ç¡®
```

#### é—®é¢˜ 2ï¼šè§†é¢‘å¸§æ•°ä¸è¶³

```
IndexError: list index out of range
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# æ£€æŸ¥è§†é¢‘å¸§æ•°
for video_dir in glob.glob('dataset/REDS/train/HR/*'):
    frame_count = len(glob.glob(os.path.join(video_dir, '*')))
    if frame_count < args.n_sequence:
        print(f"è§†é¢‘ {video_dir} å¸§æ•°ä¸è¶³: {frame_count}")

# è§£å†³æ–¹æ³•ï¼š
# 1. å¢åŠ è§†é¢‘å¸§æ•°
# 2. å‡å° n_sequence å‚æ•°
# 3. è¿‡æ»¤çŸ­è§†é¢‘
```

#### é—®é¢˜ 3ï¼šå†…å­˜ä¸è¶³

```
RuntimeError: CUDA out of memory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# å†…å­˜ä¼˜åŒ–ç­–ç•¥
args.batch_size = 1         # å‡å°æ‰¹å¤„ç†å¤§å°
args.patch_size = 128       # å‡å°patchå¤§å°
args.process = False        # å…³é—­é¢„åŠ è½½
args.n_frames_per_video = 20  # å‡å°‘æ¯è§†é¢‘å¸§æ•°
```

### ğŸ”§ æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®åŠ è½½åŠ é€Ÿ

```python
# 1. ä½¿ç”¨SSDå­˜å‚¨æ•°æ®é›†
# 2. å¯ç”¨å¤šçº¿ç¨‹åŠ è½½
# 3. é¢„å¤„ç†æ•°æ®æ ¼å¼è½¬æ¢
# 4. ä½¿ç”¨å†…å­˜å……è¶³æ—¶å¯ç”¨é¢„åŠ è½½
```

#### è®­ç»ƒæ•ˆç‡ä¼˜åŒ–

```python
# patchå¤§å°å¯¹ç…§è¡¨
# GPUå†…å­˜ -> æ¨èpatch_size -> æ¨èbatch_size
# 4GB    -> 128            -> 1
# 8GB    -> 160            -> 2
# 12GB   -> 192            -> 4
# 16GB+  -> 224            -> 8
```

### ğŸ“Š è°ƒè¯•å·¥å…·

#### æ•°æ®é›†éªŒè¯è„šæœ¬

```python
# åˆ›å»º debug_dataset.py
import os
import glob
from data.reds_blurdown_realistic import REDS_BLURDOWN_REALISTIC

def check_dataset(data_dir):
    print(f"æ£€æŸ¥æ•°æ®é›†: {data_dir}")

    # æ£€æŸ¥ç›®å½•å­˜åœ¨æ€§
    if not os.path.exists(data_dir):
        print(f"âŒ ç›®å½•ä¸å­˜åœ¨: {data_dir}")
        return False

    # ç»Ÿè®¡è§†é¢‘æ•°é‡
    video_dirs = glob.glob(os.path.join(data_dir, 'HR', '*'))
    print(f"ğŸ“ è§†é¢‘æ•°é‡: {len(video_dirs)}")

    # æ£€æŸ¥æ¯ä¸ªè§†é¢‘çš„å¸§æ•°
    frame_counts = []
    for video_dir in video_dirs[:5]:  # æ£€æŸ¥å‰5ä¸ª
        frames = glob.glob(os.path.join(video_dir, '*'))
        frame_counts.append(len(frames))
        print(f"ğŸ“· {os.path.basename(video_dir)}: {len(frames)} å¸§")

    print(f"ğŸ“Š å¹³å‡å¸§æ•°: {sum(frame_counts)/len(frame_counts):.1f}")
    return True

# è¿è¡Œæ£€æŸ¥
check_dataset('../dataset/REDS/train')
```

#### å•æ ·æœ¬æµ‹è¯•

```python
# æµ‹è¯•å•ä¸ªæ ·æœ¬åŠ è½½
from option import args
dataset = REDS_BLURDOWN_REALISTIC(args, train=True)

# è·å–ç¬¬ä¸€ä¸ªæ ·æœ¬
inputs, gts, kernels, filenames = dataset[0]
print(f"è¾“å…¥å½¢çŠ¶: {inputs.shape}")      # [5, 3, 40, 40]
print(f"GTå½¢çŠ¶: {gts.shape}")           # [5, 3, 160, 160]
print(f"æ ¸å½¢çŠ¶: {kernels.shape}")       # [5, 1, 20, 20]
print(f"æ–‡ä»¶å: {filenames}")           # ['000.00000', ...]
```

---

## æ€»ç»“

### ğŸ¯ å…³é”®è¦ç‚¹

1. **ğŸ“ ç›®å½•ç»“æ„**ï¼šä¸¥æ ¼æŒ‰ç…§æŒ‡å®šæ ¼å¼ç»„ç»‡æ•°æ®
2. **ğŸ”§ é…ç½®æ­£ç¡®**ï¼šç¡®ä¿è·¯å¾„å’Œå‚æ•°é…ç½®æ­£ç¡®
3. **ğŸ’¾ å†…å­˜ç®¡ç†**ï¼šæ ¹æ®ç¡¬ä»¶é…ç½®åˆç†è®¾ç½®å‚æ•°
4. **ğŸš€ æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨å¤šçº¿ç¨‹å’Œé¢„åŠ è½½æå‡æ•ˆç‡

### ğŸ“‹ æ£€æŸ¥æ¸…å•

-   [ ] æ•°æ®é›†ç›®å½•ç»“æ„æ­£ç¡®
-   [ ] å›¾åƒæ ¼å¼å’Œå‘½åè§„èŒƒ
-   [ ] é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®
-   [ ] ç¡¬ä»¶èµ„æºå……è¶³ï¼ˆå†…å­˜/æ˜¾å­˜ï¼‰
-   [ ] æ•°æ®åŠ è½½æµ‹è¯•é€šè¿‡

### ğŸ”— ç›¸å…³æ–‡æ¡£

-   [Jittor æœºåˆ¶è¯´æ˜](./JITTOR_æœºåˆ¶è¯´æ˜.md)
-   [é—®é¢˜è§£å†³è®°å½•](./é—®é¢˜è§£å†³è®°å½•.md)
-   [è®­ç»ƒé…ç½®è¯´æ˜](./option/template.py)

é€šè¿‡éµå¾ªæœ¬æ–‡æ¡£çš„æ•°æ®é›†æ ¼å¼è¦æ±‚ï¼Œæ‚¨å¯ä»¥æˆåŠŸé…ç½®å’Œä½¿ç”¨ Self-Blind-VSR è¿›è¡Œè§†é¢‘è¶…åˆ†è¾¨ç‡è®­ç»ƒå’Œæµ‹è¯•ã€‚
